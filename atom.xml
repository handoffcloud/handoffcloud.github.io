<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>handoff</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://handoff.cloud/"/>
  <updated>2021-07-22T05:38:37.245Z</updated>
  <id>http://handoff.cloud/</id>
  
  <author>
    <name>handoff</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Introducing Handoff: Serverless Data Pipeline Orchestration Framework</title>
    <link href="http://handoff.cloud/2021/03/20/handoff-Serverless-Data-Pipeline-Orchestration-Framework/"/>
    <id>http://handoff.cloud/2021/03/20/handoff-Serverless-Data-Pipeline-Orchestration-Framework/</id>
    <published>2021-03-20T13:47:40.000Z</published>
    <updated>2021-07-22T05:38:37.245Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://articles.anelen.co/images/keep-flowing-handoff.gif" alt="data-flow"></p><p>This article presents the business context and a technical deep dive of our serverless approach to data pipeline deployment. Our approach is <a href="https://github.com/anelendata/handoff" target="_blank" rel="noopener">open-sourced</a> as handoff: framework for serverless data pipeline orchestration.</p><h2 id="Business-Context-Helping-businesses-bring-any-data-anywhere"><a href="#Business-Context-Helping-businesses-bring-any-data-anywhere" class="headerlink" title="Business Context: Helping businesses bring any data anywhere"></a>Business Context: Helping businesses bring any data anywhere</h2><p>More and more companies have started to leverage cloud applications and their data in order to make their operation lean and effective. For example, D2C (direct to consumer) companies produce niche household products and ship directly to their customers instead of relying on a traditional retail distribution channel.</p><p>In doing so, a D2C company may use a marketing automation platform like Marketo or Pardot, run ads on Facebook and Google, and manage the supply chain with Flexport: All of these applications produce customer experience data. It is a common practice to extract data from cloud services and load them into a data warehouse (DWH). By combining data sources and analyzing them together, the business continuously improves the quality of the customer experience.</p><p>We are a technology-leveraged service company offering custom ETL/ELT solutions. ETL stands for Extracting, Transforming, and Loading of data. ELT workflows are becoming popular. Data are extracted and loaded into the data warehouse before transformation is executed by a massively parallel modern DWH engine.</p><p>The demand for implementing data pipelines is growing at an unprecedented pace. Data replication services such as Fivetran and StitchData provide data connectors for popular cloud applications such as Salesforce and Zendesk. However, those companies cannot support the long-tail of cloud applications in the Software as a Service (SaaS) market. If a cloud application is not supported, a business needs a custom data engineering job, but not every company can afford to developing an internal data engineering team.</p><p><img src="https://articles.anelen.co/images/long-tail.png" alt="No cloud apps left behind"></p><p>That is why fully-managed ETL services like ours are becoming the new option: With a fraction of the cost of hiring a data engineer, businesses can install the tailor-made data pipeline service.</p><p>While we serve our customers with active monitoring and maintenance, we decided to open-source the core framework as a contribution to data engineering community. In the rest of the article, we will share the technical solution that made our service possible.</p><h2 id="Technical-challenges-and-solution"><a href="#Technical-challenges-and-solution" class="headerlink" title="Technical challenges and solution"></a>Technical challenges and solution</h2><p>If you are the director of data engineering for your company’s internal operations, it makes sense to set up an Apache Airflow or subscribe to a managed service by Astronomer or Cloud Composer by Google Cloud Platform. Instead, we are a lean team helping others to perform the data integration of cloud applications in the long tail.</p><p>Simultaneously serving the data pipelines for many different clients change the technical requirements a lot. The most important part is to provide separate CPU, memory, and storage capacities for each client. We wanted to achieve this with maximum flexibility. When we started we only had a few data pipelines to manage, but we expected the number to rapidly grow.</p><h2 id="AWS-Lambda-vs-Fargate"><a href="#AWS-Lambda-vs-Fargate" class="headerlink" title="AWS Lambda vs. Fargate"></a>AWS Lambda vs. Fargate</h2><p>We went for a serverless approach. Our first prototype used Amazon Web Services (AWS) Lambda. It was quick to implement. The pay-as-you-go pricing was very attractive. We didn’t have to pay for idling the virtual machine or deal with peak-time auto-scaling challenges. But we soon realized that Lambda’s 15 minutes processing time limit is not enough for some tasks. So we switched to Fargate, another pay-as-you-go serverless platform by AWS. It has no time limit and the life-cycle management and scaling of computing resource is fully managed by the platform.</p><p>Compared to Lambda, Fargate’s deployment process is much more complex. Lambda could be deployed just by writing a script file. Fargate deployment involves Docker image creation, pushing the image to Elastic Container Registry, creating resources such as Virtual Private Cloud and Security Groups, defining the Fargate task, managing the Policy, and so on.</p><h2 id="Birth-of-handoff-A-serverless-data-pipeline-orchestration-framework"><a href="#Birth-of-handoff-A-serverless-data-pipeline-orchestration-framework" class="headerlink" title="Birth of handoff: A serverless data pipeline orchestration framework"></a>Birth of handoff: A serverless data pipeline orchestration framework</h2><p>The painful Fargate deployment process gave us the idea to implement a command-line interface (CLI) that we later named “handoff”. handoff simplifies the deployment steps for AWS Fargate. We may also provide a multi-cloud capability in the future: handoff unifies the commands to deploy to AWS, Microsoft Azure, Google Cloud Platform, and so on.</p><p>handoff describes the data pipeline logic in a YAML file. The first thing is to describe the installation of the modules required by the pipeline logic:</p><p>project.yml:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">version: 0.3</span><br><span class="line">description: Fetch foreign exchange rates</span><br><span class="line"></span><br><span class="line">installs:</span><br><span class="line">- venv: extractor</span><br><span class="line">  command: pip install tap-exchangeratesapi</span><br><span class="line">- venv: loader</span><br><span class="line">  command: pip install target-bigquery-partition</span><br></pre></td></tr></table></figure><p>As you can see, handoff is created primarily for Python. You can install modules in separate virtual environments if needed: handoff automatically generates multiple virtual environments. In local testing, you can install modules by running:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">handoff workspace install --project &lt;project_dir&gt; --workspace &lt;workspace_dir&gt;</span><br></pre></td></tr></table></figure><p>The pipeline logic is described as groups of tasks. In a task group, each command can be linked as a Unix pipeline:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">tasks:</span><br><span class="line">- name: fetch_exchange_rates</span><br><span class="line">  description: Fetch exchange rates and load on BigQuery</span><br><span class="line">  pipeline:</span><br><span class="line">  - command: tap-exchangeratesapi</span><br><span class="line">    args: --config files&#x2F;tap-config.json</span><br><span class="line">    venv: extractor</span><br><span class="line">  - command: &quot;target-bigquery --config files&#x2F;target_config.json&quot;</span><br><span class="line">    venv: loader</span><br></pre></td></tr></table></figure><p>The pipeline is particularly useful in deploying memory-efficient tasks such as the ELT task by singer.io framework.</p><p>The following command runs the task locally:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">handoff run local -p &lt;project_dir&gt; -w &lt;workspace_dir&gt;</span><br></pre></td></tr></table></figure><h2 id="Doing-more-than-a-simple-data-replication-task"><a href="#Doing-more-than-a-simple-data-replication-task" class="headerlink" title="Doing more than a simple data replication task"></a>Doing more than a simple data replication task</h2><p>handoff also implements simple control flows such as for-each and fork. You can also define a task beyond simple ETL. Look how we automate the task of fetching stock market data, make a GIF animation, and post it on Twitter:</p><blockquote class="twitter-tweet"><p lang="en" dir="ltr">A fun demo: handoff&#39;s <a href="https://twitter.com/hashtag/datapipeline?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#datapipeline</a> can automatically harvest data and post data-driven content to Twitter <a href="https://twitter.com/hashtag/etl?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#etl</a> <a href="https://twitter.com/hashtag/analytics?src=hash&amp;ref_src=twsrc%5Etfw" target="_blank" rel="noopener">#analytics</a>. <a href="https://t.co/0ITR771mh9" target="_blank" rel="noopener">pic.twitter.com/0ITR771mh9</a></p>&mdash; handoff (@handoffcloud) <a href="https://twitter.com/handoffcloud/status/1377477316448636935?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">April 1, 2021</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><h2 id="Deployment-features"><a href="#Deployment-features" class="headerlink" title="Deployment features"></a>Deployment features</h2><p>We estimate authoring pipeline logic is just 20% of the ETL development. To run the pipeline in production, we need to implement management of:</p><ul><li>Run-time configuration</li><li>Secret keys</li><li>Scheduling</li><li>Logging</li><li>Monitoring</li><li>Containerization<br>…and the list goes on. handoff’s project.yml helps to keep those organized and it is intuitive to understand. Here is an example of project.yml:</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">vars:</span><br><span class="line">- key: gcp_project_id</span><br><span class="line">  value: &quot;handoff-demo&quot;</span><br><span class="line">- key: dataset_id</span><br><span class="line">  value: exchangerate</span><br><span class="line"></span><br><span class="line">envs:</span><br><span class="line">- key: GOOGLE_APPLICATION_CREDENTIALS</span><br><span class="line">  value: files&#x2F;google_client_secret.json</span><br><span class="line"></span><br><span class="line">deploy:</span><br><span class="line">  cloud_provider: aws</span><br><span class="line">  cloud_platform: fargate</span><br><span class="line">  resource_group: handoff-etl</span><br><span class="line">  container_image: tap-rest-api-target-bigquery</span><br><span class="line">  task: usgs-earthquakes</span><br><span class="line"></span><br><span class="line">schedules:</span><br><span class="line">- target_id: 1</span><br><span class="line">  description: Run everyday at 00:00:00Z</span><br><span class="line">  envs:</span><br><span class="line">  - key: __VARS</span><br><span class="line">    value: &#39;start_datetime&#x3D;$(date -Iseconds -d &quot;00:00 yesterday&quot;) end_datetime&#x3D;$(date -Iseconds -d &quot;00:00 today&quot;)&#39;</span><br><span class="line">  cron: &#39;0 0 * * ? *&#39;</span><br></pre></td></tr></table></figure><p>The commands to execute the containerization and the deployment are also simple and intuitive:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># Push project configuration, supporting files, and secrets to AWS</span><br><span class="line">handoff project push -p &lt;project_dir&gt;</span><br><span class="line"></span><br><span class="line"># Build a Docker image and push to ECR</span><br><span class="line">handoff container build -p &lt;project_dir&gt;</span><br><span class="line">handoff container push -p &lt;project_dir&gt;</span><br><span class="line"></span><br><span class="line"># Create resource group, bucket, task...</span><br><span class="line">handoff cloud bucket create -p &lt;project_dir&gt;</span><br><span class="line">handoff cloud resources create -p &lt;project_dir&gt;</span><br><span class="line">handoff cloud task create -p &lt;project_dir&gt;</span><br><span class="line"></span><br><span class="line"># Schedule a task</span><br><span class="line">handoff cloud schedule create -p &lt;project_dir&gt;</span><br></pre></td></tr></table></figure><p>handoff simplifies development and deployment. Without handoff, you would have to author CloudFormation templates, deal with boto3 commands to transfer files to S3, figure out a way to encrypt and store the secrets, configure the CloudWatch for logging and metrics, etc.</p><p>For a full handoff tutorial, please visit <a href="https://dev.handoff.cloud" target="_blank" rel="noopener">https://dev.handoff.cloud</a></p><p>We made handoff <a href="https://github.com/anelendata/handoff" target="_blank" rel="noopener">a public project on GitHub</a> so every engineer having a similar challenge can use it. We also welcome collaborators to improve this new framework.</p><p><a href="https://articles.anelen.co/images/this_is_handoff.png" target="_blank" rel="noopener">handoff open source</a></p><h2 id="What’s-next"><a href="#What’s-next" class="headerlink" title="What’s next?"></a>What’s next?</h2><p>As we mentioned earlier, we may support deployment to other cloud platforms such as Microsoft Azure and Google Cloud Platform. Unifying the deployment commands for multi-cloud would be very useful in quickly switching platforms.</p><p>We also prototyped a web UI built on top of the CLI:</p><p><a href="https://articles.anelen.co/images/handoff-ui.gif" target="_blank" rel="noopener">dashboard</a></p><p>The web UI could be running as a stand-alone application on your local machine. It will spin up a local web server. You can interact with handoff via the web UI and the backend connects to cloud resources. It can also be hosted on a server for enterprise use cases.</p><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>AWS Fargate lets us create a cost-effective and scalable solution for ETL deployment. However, it hasn’t been a popular approach due to the complex deployment process. handoff, a serverless data pipeline orchestration framework simplifies it. handoff also manages the various aspects of the orchestration such as security and monitoring. We made handoff an open-source project so that the data engineering community can benefit from it and collaborate for further innovation.</p><h2 id="About-the-author"><a href="#About-the-author" class="headerlink" title="About the author"></a>About the author</h2><p><a href="https://www.linkedin.com/in/daigotanaka/" target="_blank" rel="noopener">Daigo Tanaka</a> is CEO and data scientist at <a href="https://anelen.co/" target="_blank" rel="noopener">ANELEN</a>, a boutique consulting firm focused on data engineering, analytics, and data science. ANELEN’s mission is to help innovative businesses make smarter decisions with data science. ANELEN is the provider of handoff.could ETL/ELT service.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;https://articles.anelen.co/images/keep-flowing-handoff.gif&quot; alt=&quot;data-flow&quot;&gt;&lt;/p&gt;
&lt;p&gt;This article presents the business context 
      
    
    </summary>
    
    <content src="http://handoff.cloud/https://articles.anelen.co/images/keep-flowing-handoff.gif" type="image" />
    
    
    
  </entry>
  
</feed>
